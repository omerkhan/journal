---
interface Props {
  title?: string;
  date: Date;
  slug: string;
  media?: {
    url: string;
    type: 'image' | 'video';
    alt: string;
  };
  excerpt: string;
}

const { title, date, slug, media, excerpt } = Astro.props;

const formattedDate = date.toLocaleDateString('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric',
});

const hasMedia = !!media;
---

<article class="group">
  <a href={`/posts/${slug}`} class="block no-underline">
    {hasMedia && (
      <div class="mb-4 overflow-hidden rounded-lg">
        {media.type === 'image' ? (
          <img
            src={media.url}
            alt={media.alt}
            class="w-full h-auto object-cover transition-transform duration-300 group-hover:scale-[1.02]"
            loading="lazy"
          />
        ) : (
          <video
            src={media.url}
            class="w-full h-auto object-cover"
            muted
            loop
            playsinline
            preload="metadata"
          />
        )}
      </div>
    )}

    <div class:list={[
      'transition-colors duration-200',
      !hasMedia && 'p-6 bg-surface rounded-lg border border-border group-hover:border-accent/30'
    ]}>
      {title && (
        <h2 class="font-serif text-xl sm:text-2xl text-text-primary group-hover:text-accent transition-colors duration-200 mb-2">
          {title}
        </h2>
      )}

      <p class="text-text-secondary text-sm mb-3">
        {formattedDate}
      </p>

      <p class:list={[
        'text-text-primary leading-relaxed',
        hasMedia ? 'line-clamp-3' : 'line-clamp-6'
      ]}>
        {excerpt}
      </p>
    </div>
  </a>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .line-clamp-6 {
    display: -webkit-box;
    -webkit-line-clamp: 6;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
